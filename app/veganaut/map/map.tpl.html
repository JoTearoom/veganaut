<div ng-controller="MapCtrl">
    <div class="top-box top-box--full-width container main-container"
     ng-hide="location.active || productShown || filtersShown || searchShown">
        <div class="top-box--full-width__border-offset">
            <div class="btn-group--top-box">
                <div ng-if="isEmbedded">
                    <a type="button" class="btn-logo btn btn-default btn-default--transparent"
                     ng-click="goToView('/')">
                        <svg class="logo logo--top-box">
                            <use xlink:href="" ng-href="{{:: getLogoUrl() }}"/>
                        </svg>
                    </a>
                </div>
                <button type="button" class="btn-show-product-list btn btn-default btn-default--transparent"
                 title="{{ 'action.map.showProductList.description' | translate }}"
                 ng-click="showProductList(true)">
                    <span class="glyphicon glyphicon-cutlery"></span><br />
                    <span class="small">{{ 'action.map.showProductList.name' | translate }}</span>
                </button>
                <button type="button" class="btn-show-search btn btn-default btn-default--transparent"
                 ng-click="showSearch(true)"
                 title="{{ 'action.map.searchMap.description' | translate }}">
                    <span class="glyphicon glyphicon-search"></span><br />
                    <span class="small">{{ 'action.map.searchMap.name' | translate }}</span>
                </button>
                <!--<button type="button" class="btn-show-location-filters btn btn-default btn-default&#45;&#45;transparent"-->
                 <!--ng-if="!isEmbedded"-->
                 <!--ng-click="showFilters(true)" ng-class="{active: numActiveFilters() > 0}"-->
                 <!--title="{{ 'action.map.filterMap.description' | translate }}">-->
                    <!--<span class="glyphicon glyphicon-filter"></span><br />-->
                    <!--<span class="small">{{ 'action.map.filterMap.name' | translate }}</span>-->
                <!--</button>-->
                <button type="button" class="btn-location-list btn btn-default btn-default--transparent"
                 ng-click="goToLocationList()"
                 title="{{ 'action.map.showList.description' | translate }}">
                    <span class="glyphicon glyphicon-th-list"></span><br />
                    <span class="small">{{ 'action.map.showList.name' | translate }}</span>
                </button>
                <button type="button" class="btn-register btn btn-primary"
                 ng-if="!isLoggedIn()"
                 ng-click="goToView('register')"
                 title="{{ 'action.map.register.description' | translate }}">
                    <span class="glyphicon glyphicon-heart"></span><br />
                    <span class="small">{{ 'action.map.register.name' | translate }}</span>
                </button>
                <button type="button" class="add-location btn btn-block btn-primary"
                 ng-if="isLoggedIn()"
                 ng-click="startAddNewLocation()"
                 title="{{ 'action.map.addLocation.description' | translate }}">
                    <span class="glyphicon glyphicon-plus-sign"></span><br />
                    <span class="small">{{ 'action.map.addLocation.name' | translate }}</span>
                </button>
            </div>
        </div>
    </div>

    <!-- TODO: get rid of complicated ng-show in view -->
    <div class="top-box container main-container"
     ng-show="locationService.active || productShown || filtersShown || searchShown">
        <div class="text-center location-details" ng-show="locationService.active && !locationService.isAddingLocation()">
            <div class="pull-right clickable" ng-click="locationService.activate()">
                <span class="glyphicon glyphicon-remove"></span>
            </div>

            <p>
                <vg-location-type-badge location="locationService.active"></vg-location-type-badge>
                <strong>{{ locationService.active.name }}</strong>
                <vg-location-quality-icon location="locationService.active"></vg-location-quality-icon>
                <vg-location-effort-icon location="locationService.active"></vg-location-effort-icon>
                <span ng-show="locationService.active.getProductsByAvailability('available').length > 0">
                    <br/>
                    {{ 'location.products.summary' | translate:{
                        product: locationService.active.getProductsByAvailability('available')[0].name,
                        number: locationService.active.getProductsByAvailability('available').length - 1}
                    }}
                </span>
            </p>

            <p ng-show="locationService.active.id">
                <button type="button" class="btn btn-block btn-primary"
                 ng-click="visitLocation(locationService.active)">
                    <span class="glyphicon glyphicon-hand-right"></span>
                    <span ng-bind="'action.map.locationAction'|translate"></span>
                </button>
            </p>
        </div>

        <ng-include src="'/veganaut/map/addLocation.tpl.html'" ng-if="locationService.isAddingLocation()"></ng-include>
        <ng-include src="'/veganaut/map/productList.tpl.html'" ng-if="productShown"></ng-include>
        <ng-include src="'/veganaut/map/search.tpl.html'" ng-if="searchShown"></ng-include>
        <ng-include src="'/veganaut/map/locationFilters.tpl.html'" ng-show="filtersShown"></ng-include>
    </div>

    <leaflet class="main-map full-viewport"
     ng-class="{'map--placing-location': isPlacingLocation()}"
     defaults="mapDefaults" lf-center="mainMap.center" event-broadcast="events">
    </leaflet>

    <vg-geolocate-button></vg-geolocate-button>
</div>
