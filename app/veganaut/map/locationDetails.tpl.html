<div ng-controller="LocationDetailsCtrl">
    <h1>{{ location.title }}</h1>
    <p>
        <vg-location-type-badge location="location"></vg-location-type-badge>
        <vg-team-badge team="location.team"></vg-team-badge>
    </p>

    <div ng-if="location.type !== 'private'">
        <div ng-repeat="mission in missions" class="pageSection well" ng-if="mission.isAvailable()">
            <p class="lead">
                <span class="glyphicon glyphicon-ok" ng-show="mission.completed"></span>
                {{ 'map.mission.' + mission.id + '.description' | trans }}
            </p>
            <div class="actionBlock" ng-hide="mission.completed">
                <p>
                    <button type="button" class="btn btn-block btnTeam locationAction"
                     ng-click="mission.showing = true" ng-disabled="mission.showing">
                        <span class="glyphicon glyphicon-{{ mission.callToActionIcon }}"></span>
                        {{ 'map.mission.' + mission.id + '.callToAction' | trans }}
                    </button>
                </p>

                <div class="missionBlock" ng-show="mission.showing">
                    <form novalidate name="answerForm" class="{{ mission.id }}Form">
                        <div ng-switch="mission.id">
                            <!--TODO: translate-->
                            <div ng-switch-when="optionsAvailable">
                                <p>Do they have vegan options?</p>
                                <div class="btn-group pull-right">
                                    <label class="btn btn-default" ng-model="mission.answer.hasVegan" btn-radio="true">Yes</label>
                                    <label class="btn btn-default" ng-model="mission.answer.hasVegan" btn-radio="false">No</label>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                            <div ng-switch-when="whatOptions">
                                <input type="text" ng-required="$index === 0" class="form-control"
                                 ng-repeat="answer in mission.answers"
                                 ng-model="answer.text"
                                 placeholder="Vegan Option No. {{ $index + 1 }}"/>
                            </div>
                            <div ng-switch-when="buyOptions">
                                <div class="checkbox" ng-repeat="veganOption in missionById.whatOptions.answers">
                                    <label>
                                        <input type="checkbox" ng-model="mission.answers[veganOption.id]" />
                                        {{ veganOption.text }}
                                    </label>
                                </div>
                            </div>
                            <div ng-switch-when="staffFeedback">
                                <textarea class="form-control" required
                                 ng-model="mission.answer.text"
                                 placeholder="Feedback you gave the staff"></textarea>
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" ng-model="mission.answer.didNotDoIt" />
                                        I wanted to give this feedback, but then didn't.
                                    </label>
                                </div>
                            </div>
                            <div ng-switch-when="rateLocation">
                                <div class="text-center h1">
                                    <rating ng-model="mission.answer.rating"
                                     max="mission.maxRating"></rating>
                                </div>
                            </div>
                        </div>

                        <button type="button" class="btn btn-default"
                         ng-click="mission.showing = false">
                            {{ 'map.mission.form.cancel' | trans }}
                        </button>
                        <button type="submit" class="btn btn-default btnTeam pull-right"
                         ng-disabled="answerForm.$invalid || !mission.hasValidAnswer()" ng-click="submit(mission)">
                            <span class="glyphicon glyphicon-ok"></span>
                            {{ 'map.mission.form.submit' | trans }}
                        </button>
                    </form>
                </div>
            </div>

            <div class="resultBlock" ng-show="mission.completed">
                <div ng-switch="mission.id">
                    <!--TODO: translate-->
                    <div ng-switch-when="optionsAvailable">
                        <div ng-show="mission.answer.hasVegan">You say there are vegan options available.</div>
                        <div ng-hide="mission.answer.hasVegan">You say there are no vegan options available.</div>
                    </div>
                    <div ng-switch-when="whatOptions">
                        You know of the following options:
                        <ul>
                            <li ng-repeat="answer in mission.answers">{{ answer.text }}</li>
                        </ul>
                    </div>
                    <div ng-switch-when="buyOptions">
                        You bought the following options:
                        <ul>
                            <li ng-repeat="option in mission.getBoughtOptions()">{{ option.text }}</li>
                        </ul>
                    </div>
                    <div ng-switch-when="staffFeedback">
                        <p>
                            <span ng-show="mission.answer.didNotDoIt">You wanted to give the following feedback:</span>
                            <span ng-hide="mission.answer.didNotDoIt">You gave the following feedback:</span>
                            <br />
                            <em>{{ mission.answer.text }}</em>
                        </p>
                    </div>
                    <div ng-switch-when="rateLocation">
                        You rating:
                        <rating readonly="true" ng-model="mission.answer.rating"
                         max="mission.maxRating"></rating>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <leaflet class="locationDetailMap"
     markers="[location]" defaults="mapSettings" center="center">
    </leaflet>
</div>
